{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jason/Nocodile/frontend/lib/logger.ts"],"sourcesContent":["// Centralized logging utility for API monitoring and debugging\r\nexport enum LogLevel {\r\n  DEBUG = 0,\r\n  INFO = 1,\r\n  WARN = 2,\r\n  ERROR = 3,\r\n}\r\n\r\nexport interface LogEntry {\r\n  timestamp: string;\r\n  level: LogLevel;\r\n  category: string;\r\n  message: string;\r\n  data?: any;\r\n  url?: string;\r\n  status?: number;\r\n  duration?: number;\r\n}\r\n\r\nclass Logger {\r\n  private logs: LogEntry[] = [];\r\n  private maxLogs = 1000; // Keep last 1000 logs\r\n  private currentLevel = LogLevel.INFO;\r\n  private listeners: ((logs: LogEntry[]) => void)[] = [];\r\n\r\n  constructor() {\r\n    // Load log level from localStorage or default to INFO (only in browser)\r\n    if (typeof window !== 'undefined' && typeof window.localStorage !== 'undefined') {\r\n      try {\r\n        const savedLevel = localStorage.getItem('logLevel');\r\n        if (savedLevel) {\r\n          this.currentLevel = parseInt(savedLevel) as LogLevel;\r\n        }\r\n      } catch (error) {\r\n        // localStorage might not be available in some environments\r\n        console.warn('Failed to access localStorage:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  private addLog(level: LogLevel, category: string, message: string, data?: any, url?: string, status?: number, duration?: number) {\r\n    const logEntry: LogEntry = {\r\n      timestamp: new Date().toISOString(),\r\n      level,\r\n      category,\r\n      message,\r\n      data,\r\n      url,\r\n      status,\r\n      duration,\r\n    };\r\n\r\n    this.logs.unshift(logEntry);\r\n    \r\n    // Keep only the last maxLogs entries\r\n    if (this.logs.length > this.maxLogs) {\r\n      this.logs = this.logs.slice(0, this.maxLogs);\r\n    }\r\n\r\n    // Notify listeners\r\n    this.listeners.forEach(listener => listener([...this.logs]));\r\n\r\n    // Console output with colors and better formatting\r\n    const levelNames = ['DEBUG', 'INFO', 'WARN', 'ERROR'];\r\n    const colors = ['#888', '#2196F3', '#FF9800', '#F44336'];\r\n    const levelName = levelNames[level];\r\n    const color = colors[level];\r\n    \r\n    // Enhanced console output with timestamp and better formatting\r\n    const timestamp = new Date().toLocaleTimeString();\r\n    const urlInfo = url ? ` â†’ ${url}` : '';\r\n    const statusInfo = status ? ` (${status})` : '';\r\n    const durationInfo = duration ? ` [${duration}ms]` : '';\r\n    \r\n    console.log(\r\n      `%c[${timestamp}] %c[${levelName}] %c[${category}] %c${message}${urlInfo}${statusInfo}${durationInfo}`,\r\n      `color: #666; font-size: 11px;`,\r\n      `color: ${color}; font-weight: bold; font-size: 12px;`,\r\n      `color: #666; font-size: 11px;`,\r\n      `color: #000; font-size: 12px;`,\r\n      data ? data : ''\r\n    );\r\n  }\r\n\r\n  debug(category: string, message: string, data?: any) {\r\n    if (this.currentLevel <= LogLevel.DEBUG) {\r\n      this.addLog(LogLevel.DEBUG, category, message, data);\r\n    }\r\n  }\r\n\r\n  info(category: string, message: string, data?: any) {\r\n    if (this.currentLevel <= LogLevel.INFO) {\r\n      this.addLog(LogLevel.INFO, category, message, data);\r\n    }\r\n  }\r\n\r\n  warn(category: string, message: string, data?: any) {\r\n    if (this.currentLevel <= LogLevel.WARN) {\r\n      this.addLog(LogLevel.WARN, category, message, data);\r\n    }\r\n  }\r\n\r\n  error(category: string, message: string, data?: any) {\r\n    if (this.currentLevel <= LogLevel.ERROR) {\r\n      this.addLog(LogLevel.ERROR, category, message, data);\r\n    }\r\n  }\r\n\r\n  // API-specific logging methods\r\n  apiCall(url: string, method: string, data?: any) {\r\n    this.info('API', `Making ${method} request to ${url}`, data);\r\n  }\r\n\r\n  apiSuccess(url: string, method: string, status: number, duration: number, response?: any) {\r\n    this.info('API', `${method} ${url} - Success (${status})`, { duration: `${duration}ms`, response });\r\n  }\r\n\r\n  apiError(url: string, method: string, error: any, duration?: number) {\r\n    this.error('API', `${method} ${url} - Failed`, { error: error.message || error, duration: duration ? `${duration}ms` : 'N/A' });\r\n  }\r\n\r\n  apiTimeout(url: string, method: string, duration: number) {\r\n    this.warn('API', `${method} ${url} - Timeout after ${duration}ms`);\r\n  }\r\n\r\n  connectionTest(url: string, success: boolean, duration?: number) {\r\n    if (success) {\r\n      this.info('CONNECTION', `âœ… Backend connection successful: ${url}`, { duration: duration ? `${duration}ms` : 'N/A' });\r\n    } else {\r\n      this.warn('CONNECTION', `âŒ Backend connection failed: ${url}`, { duration: duration ? `${duration}ms` : 'N/A' });\r\n    }\r\n  }\r\n\r\n  // Get all logs\r\n  getLogs(): LogEntry[] {\r\n    return [...this.logs];\r\n  }\r\n\r\n  // Get logs by category\r\n  getLogsByCategory(category: string): LogEntry[] {\r\n    return this.logs.filter(log => log.category === category);\r\n  }\r\n\r\n  // Get logs by level\r\n  getLogsByLevel(level: LogLevel): LogEntry[] {\r\n    return this.logs.filter(log => log.level === level);\r\n  }\r\n\r\n  // Clear logs\r\n  clearLogs() {\r\n    this.logs = [];\r\n    this.listeners.forEach(listener => listener([]));\r\n  }\r\n\r\n  // Set log level\r\n  setLogLevel(level: LogLevel) {\r\n    this.currentLevel = level;\r\n    if (typeof window !== 'undefined' && typeof window.localStorage !== 'undefined') {\r\n      try {\r\n        localStorage.setItem('logLevel', level.toString());\r\n      } catch (error) {\r\n        // localStorage might not be available in some environments\r\n        console.warn('Failed to save to localStorage:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  // Subscribe to log updates\r\n  subscribe(listener: (logs: LogEntry[]) => void) {\r\n    this.listeners.push(listener);\r\n    return () => {\r\n      const index = this.listeners.indexOf(listener);\r\n      if (index > -1) {\r\n        this.listeners.splice(index, 1);\r\n      }\r\n    };\r\n  }\r\n\r\n  // Get API health summary\r\n  getApiHealthSummary(): {\r\n    totalCalls: number;\r\n    successfulCalls: number;\r\n    failedCalls: number;\r\n    averageResponseTime: number;\r\n    lastSuccessfulCall?: string;\r\n    lastFailedCall?: string;\r\n  } {\r\n    const apiLogs = this.getLogsByCategory('API');\r\n    const totalCalls = apiLogs.length;\r\n    const successfulCalls = apiLogs.filter(log => log.status && log.status >= 200 && log.status < 300).length;\r\n    const failedCalls = apiLogs.filter(log => log.status && (log.status < 200 || log.status >= 300)).length;\r\n    \r\n    const responseTimes = apiLogs\r\n      .filter(log => log.duration)\r\n      .map(log => log.duration!);\r\n    \r\n    const averageResponseTime = responseTimes.length > 0 \r\n      ? responseTimes.reduce((sum, time) => sum + time, 0) / responseTimes.length \r\n      : 0;\r\n\r\n    const lastSuccessfulCall = apiLogs\r\n      .filter(log => log.status && log.status >= 200 && log.status < 300)\r\n      .sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime())[0]?.timestamp;\r\n\r\n    const lastFailedCall = apiLogs\r\n      .filter(log => log.status && (log.status < 200 || log.status >= 300))\r\n      .sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime())[0]?.timestamp;\r\n\r\n    return {\r\n      totalCalls,\r\n      successfulCalls,\r\n      failedCalls,\r\n      averageResponseTime: Math.round(averageResponseTime),\r\n      lastSuccessfulCall,\r\n      lastFailedCall,\r\n    };\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const logger = new Logger();\r\n\r\n// Make logger available globally for console debugging\r\nif (typeof window !== 'undefined') {\r\n  (window as any).apiLogger = logger;\r\n  (window as any).apiLogs = {\r\n    // Get all logs\r\n    all: () => logger.getLogs(),\r\n    // Get logs by category\r\n    byCategory: (category: string) => logger.getLogsByCategory(category),\r\n    // Get logs by level\r\n    byLevel: (level: LogLevel) => logger.getLogsByLevel(level),\r\n    // Get API health summary\r\n    health: () => logger.getApiHealthSummary(),\r\n    // Clear logs\r\n    clear: () => logger.clearLogs(),\r\n    // Set log level\r\n    setLevel: (level: LogLevel) => logger.setLogLevel(level),\r\n    // Test connection\r\n    testConnection: async () => {\r\n      const startTime = Date.now();\r\n      try {\r\n        const response = await fetch('http://localhost:8888/health');\r\n        const duration = Date.now() - startTime;\r\n        logger.connectionTest('http://localhost:8888', response.ok, duration);\r\n        return { success: response.ok, duration, status: response.status };\r\n      } catch (error) {\r\n        const duration = Date.now() - startTime;\r\n        logger.connectionTest('http://localhost:8888', false, duration);\r\n        return { success: false, duration, error: error instanceof Error ? error.message : String(error) };\r\n      }\r\n    }\r\n  };\r\n  \r\n  // Log level constants for easy access\r\n  (window as any).LogLevel = LogLevel;\r\n  \r\n  console.log(`\r\nğŸ”§ API Logger Console Helper Available!\r\n\r\nUsage:\r\nâ€¢ apiLogs.all() - Get all logs\r\nâ€¢ apiLogs.byCategory('API') - Get API logs\r\nâ€¢ apiLogs.byLevel(LogLevel.ERROR) - Get error logs\r\nâ€¢ apiLogs.health() - Get API health summary\r\nâ€¢ apiLogs.clear() - Clear all logs\r\nâ€¢ apiLogs.setLevel(LogLevel.DEBUG) - Set log level\r\nâ€¢ apiLogs.testConnection() - Test backend connection\r\n\r\nLog Levels: DEBUG(0), INFO(1), WARN(2), ERROR(3)\r\n  `);\r\n}\r\n\r\n// Export convenience functions\r\nexport const log = {\r\n  debug: (category: string, message: string, data?: any) => logger.debug(category, message, data),\r\n  info: (category: string, message: string, data?: any) => logger.info(category, message, data),\r\n  warn: (category: string, message: string, data?: any) => logger.warn(category, message, data),\r\n  error: (category: string, message: string, data?: any) => logger.error(category, message, data),\r\n  apiCall: (url: string, method: string, data?: any) => logger.apiCall(url, method, data),\r\n  apiSuccess: (url: string, method: string, status: number, duration: number, response?: any) => \r\n    logger.apiSuccess(url, method, status, duration, response),\r\n  apiError: (url: string, method: string, error: any, duration?: number) => \r\n    logger.apiError(url, method, error, duration),\r\n  apiTimeout: (url: string, method: string, duration: number) => \r\n    logger.apiTimeout(url, method, duration),\r\n  connectionTest: (url: string, success: boolean, duration?: number) => \r\n    logger.connectionTest(url, success, duration),\r\n};\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 267, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jason/Nocodile/frontend/lib/api.ts"],"sourcesContent":["// API service for connecting frontend to backend\r\nimport { log, logger } from './logger';\r\n\r\n// Utility function to validate and fix image data\r\nfunction validateAndFixImageData(imageData: string): string {\r\n  if (!imageData || typeof imageData !== 'string') {\r\n    console.warn('âš ï¸ [API] Invalid image data: not a string or empty');\r\n    return '';\r\n  }\r\n  \r\n  // æª¢æŸ¥æ˜¯å¦å·²ç¶“æ˜¯æ­£ç¢ºçš„ data URL æ ¼å¼\r\n  if (imageData.startsWith('data:image/')) {\r\n    // é©—è­‰ data URL æ ¼å¼æ˜¯å¦å®Œæ•´\r\n    if (imageData.includes('base64,') && imageData.length > 50) {\r\n      return imageData; // å·²ç¶“æ˜¯æ­£ç¢ºæ ¼å¼ï¼Œç›´æ¥è¿”å›\r\n    } else {\r\n      console.warn('âš ï¸ [API] Incomplete data URL detected, attempting to fix');\r\n    }\r\n  }\r\n  \r\n  // æª¢æŸ¥æ˜¯å¦ç‚º PNG æ ¼å¼çš„ base64 (å„ªå…ˆæª¢æŸ¥ PNGï¼Œå› ç‚ºå®ƒæ›´ç‰¹å®š)\r\n  if (imageData.startsWith('iVBORw0KGgo')) {\r\n    console.log('ğŸ”§ [API] Detected PNG base64 data, fixing format');\r\n    return `data:image/png;base64,${imageData}`;\r\n  }\r\n  \r\n  // æª¢æŸ¥æ˜¯å¦ç‚º JPEG æ ¼å¼çš„ base64\r\n  if (imageData.startsWith('/9j/') || imageData.startsWith('9j/')) {\r\n    console.log('ğŸ”§ [API] Detected JPEG base64 data, fixing format');\r\n    return `data:image/jpeg;base64,${imageData}`;\r\n  }\r\n  \r\n  // å¦‚æœæ²’æœ‰ data: å‰ç¶´ï¼Œå‡è¨­ç‚º JPEG æ ¼å¼\r\n  if (!imageData.startsWith('data:')) {\r\n    console.log('ğŸ”§ [API] Raw base64 data detected, adding data URL prefix');\r\n    return `data:image/jpeg;base64,${imageData}`;\r\n  }\r\n  \r\n  // å¦‚æœæ•¸æ“šå¤ªçŸ­ï¼Œå¯èƒ½æ˜¯ç„¡æ•ˆçš„\r\n  if (imageData.length < 20) {\r\n    console.warn('âš ï¸ [API] Image data too short, likely invalid');\r\n    return '';\r\n  }\r\n  \r\n  return imageData;\r\n}\r\n\r\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8888';\r\n\r\n// Fallback URLs to try if the primary URL fails\r\nconst FALLBACK_URLS = [\r\n  'http://localhost:8888',\r\n  'http://host.docker.internal:8888',\r\n  'http://backend:8888'\r\n];\r\n\r\n// Function to find a working backend URL\r\nexport async function findWorkingBackendUrl(): Promise<string> {\r\n  // First try the environment variable URL\r\n  const envUrl = process.env.NEXT_PUBLIC_API_URL;\r\n  if (envUrl) {\r\n    log.info('CONNECTION', 'Testing environment variable URL first', { url: envUrl });\r\n    const startTime = Date.now();\r\n    try {\r\n      const response = await fetch(`${envUrl}/health`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n      });\r\n      \r\n      const duration = Date.now() - startTime;\r\n      \r\n      if (response.ok) {\r\n        log.connectionTest(envUrl, true, duration);\r\n        return envUrl;\r\n      } else {\r\n        log.connectionTest(envUrl, false, duration);\r\n        log.warn('CONNECTION', `Environment URL at ${envUrl} returned status: ${response.status}`);\r\n      }\r\n    } catch (error) {\r\n      const duration = Date.now() - startTime;\r\n      log.connectionTest(envUrl, false, duration);\r\n      log.error('CONNECTION', `Environment URL at ${envUrl} failed`, { error: error instanceof Error ? error.message : String(error) });\r\n    }\r\n  }\r\n  \r\n  log.info('CONNECTION', 'Environment URL failed, trying fallback URLs', { urls: FALLBACK_URLS });\r\n  \r\n  for (const url of FALLBACK_URLS) {\r\n    const startTime = Date.now();\r\n    try {\r\n      log.debug('CONNECTION', `Testing backend URL: ${url}`);\r\n      const response = await fetch(`${url}/health`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n      });\r\n      \r\n      const duration = Date.now() - startTime;\r\n      \r\n      if (response.ok) {\r\n        log.connectionTest(url, true, duration);\r\n        return url;\r\n      } else {\r\n        log.connectionTest(url, false, duration);\r\n        log.warn('CONNECTION', `Backend at ${url} returned status: ${response.status}`);\r\n      }\r\n    } catch (error) {\r\n      const duration = Date.now() - startTime;\r\n      log.connectionTest(url, false, duration);\r\n      log.error('CONNECTION', `Backend at ${url} failed`, { error: error instanceof Error ? error.message : String(error) });\r\n    }\r\n  }\r\n  \r\n  log.error('CONNECTION', 'All backend URLs failed - no working backend found');\r\n  throw new Error('ç„¡æ³•é€£æ¥åˆ°ä»»ä½•å¾Œç«¯æœå‹™');\r\n}\r\n\r\nexport interface ProjectInfo {\r\n  id: number;\r\n  name: string;\r\n  videoCount: number;\r\n  status?: string;\r\n  isOwned?: boolean;\r\n}\r\n\r\nexport interface CreateProjectRequest {\r\n  userID: string;\r\n  project_name: string;\r\n  project_type: string;\r\n}\r\n\r\nexport interface UserRequest {\r\n  userID: string;\r\n}\r\n\r\nexport interface ProjectRequest {\r\n  project_id: string;\r\n}\r\n\r\nexport interface VideoRequest {\r\n  project_id: string;\r\n  video_id: string;\r\n}\r\n\r\nexport interface AnnotationRequest {\r\n  project_id: string;\r\n  video_id: string;\r\n  frame_num: number;\r\n  bboxes: Array<{\r\n    class_name: string;\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    height: number;\r\n  }>;\r\n}\r\n\r\nexport interface ClassInfo {\r\n  id: string;\r\n  name: string;\r\n  color: string;\r\n}\r\n\r\n// API functions\r\nexport class ApiService {\r\n  // Static method to find working backend URL\r\n  static async findWorkingBackendUrl(): Promise<string> {\r\n    return findWorkingBackendUrl();\r\n  }\r\n\r\n  // Helper method for consistent API logging\r\n  private static async makeApiCall(\r\n    endpoint: string, \r\n    method: string, \r\n    body?: any, \r\n    useWorkingUrl: boolean = false\r\n  ): Promise<Response> {\r\n    const startTime = Date.now();\r\n    const baseUrl = useWorkingUrl ? await findWorkingBackendUrl() : API_BASE_URL;\r\n    const fullUrl = `${baseUrl}${endpoint}`;\r\n    \r\n    log.apiCall(endpoint, method, body);\r\n    \r\n    try {\r\n      const response = await fetch(fullUrl, {\r\n        method,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: body ? JSON.stringify(body) : undefined,\r\n      });\r\n\r\n      const duration = Date.now() - startTime;\r\n\r\n      if (response.ok) {\r\n        log.apiSuccess(fullUrl, method, response.status, duration);\r\n      } else {\r\n        log.apiError(fullUrl, method, new Error(`HTTP ${response.status}`), duration);\r\n      }\r\n\r\n      return response;\r\n    } catch (error) {\r\n      const duration = Date.now() - startTime;\r\n      log.apiError(endpoint, method, error, duration);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Upload video file\r\n  static async uploadVideo(projectId: string, file: File): Promise<{\r\n    success: boolean;\r\n    message: string;\r\n    video_id: string;\r\n    video_path: string;\r\n    file_size: number;\r\n    project_id: string;\r\n  }> {\r\n    const startTime = Date.now();\r\n    const endpoint = '/upload';\r\n    \r\n    try {\r\n      log.apiCall(endpoint, 'POST', { projectId, fileName: file.name, fileSize: file.size });\r\n      \r\n      // Find a working backend URL\r\n      const workingUrl = await findWorkingBackendUrl();\r\n      \r\n      // Create URL with project_id as query parameter\r\n      const url = new URL(`${workingUrl}${endpoint}`);\r\n      url.searchParams.append('project_id', projectId);\r\n      \r\n      // Create FormData for file upload (only file, not project_id)\r\n      const formData = new FormData();\r\n      formData.append('file', file);\r\n      \r\n      const response = await fetch(url.toString(), {\r\n        method: 'POST',\r\n        body: formData, // Don't set Content-Type header, let browser set it with boundary\r\n      });\r\n\r\n      const duration = Date.now() - startTime;\r\n\r\n      if (!response.ok) {\r\n        log.apiError(url.toString(), 'POST', new Error(`HTTP ${response.status}`), duration);\r\n        throw new Error(`Upload failed: HTTP ${response.status}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n      log.apiSuccess(url.toString(), 'POST', response.status, duration, { \r\n        videoId: data.video_id,\r\n        fileSize: data.file_size \r\n      });\r\n      \r\n      return {\r\n        success: true,\r\n        message: data.message || 'Upload successful',\r\n        video_id: data.video_id,\r\n        video_path: data.video_path,\r\n        file_size: data.file_size,\r\n        project_id: data.project_id\r\n      };\r\n    } catch (error) {\r\n      const duration = Date.now() - startTime;\r\n      log.apiError(endpoint, 'POST', error, duration);\r\n      log.error('API', 'Error uploading video', { \r\n        projectId,\r\n        fileName: file.name,\r\n        error: error instanceof Error ? error.message : String(error) \r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Fallback videos when API fails\r\n  private static getFallbackVideos(): any[] {\r\n    return [];\r\n  }\r\n\r\n  // Get all projects for a user\r\n  static async getProjectsInfo(userId: number): Promise<ProjectInfo[]> {\r\n    const startTime = Date.now();\r\n    const endpoint = '/get_projects_info';\r\n    \r\n    try {\r\n      log.apiCall(endpoint, 'POST', { userId });\r\n      \r\n      // Find a working backend URL\r\n      const workingUrl = await findWorkingBackendUrl();\r\n      const fullUrl = `${workingUrl}${endpoint}`;\r\n      \r\n      const response = await fetch(fullUrl, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ userID: userId.toString() }),\r\n      });\r\n\r\n      const duration = Date.now() - startTime;\r\n\r\n      if (!response.ok) {\r\n        log.apiError(fullUrl, 'POST', new Error(`HTTP ${response.status}`), duration);\r\n        log.warn('API', `API returned ${response.status}, using fallback data`);\r\n        return this.getFallbackProjects();\r\n      }\r\n\r\n      const data = await response.json();\r\n      log.apiSuccess(fullUrl, 'POST', response.status, duration, { \r\n        ownedProjects: data['owned projects']?.length || 0,\r\n        sharedProjects: data['shared projects']?.length || 0 \r\n      });\r\n      \r\n      // Check if we got valid data\r\n      if (!data || (!data['owned projects'] && !data['shared projects'])) {\r\n        log.warn('API', 'Invalid API response format, using fallback data', data);\r\n        return this.getFallbackProjects();\r\n      }\r\n      \r\n      // Transform the response to match our ProjectInfo interface\r\n      const ownedProjects = data['owned projects'] || [];\r\n      const sharedProjects = data['shared projects'] || [];\r\n      \r\n      // If no projects found, return fallback\r\n      if (ownedProjects.length === 0 && sharedProjects.length === 0) {\r\n        log.info('API', 'No projects found in response, using fallback data');\r\n        return this.getFallbackProjects();\r\n      }\r\n      \r\n      // Convert project details to ProjectInfo format\r\n      const allProjects = [...ownedProjects, ...sharedProjects];\r\n      const projectDetails = allProjects.map((project: any) => ({\r\n        id: project.project_id || project.id,\r\n        name: project.project_name || 'Unknown Project',\r\n        videoCount: project.video_count || 0,\r\n        status: project.status || 'Unknown',\r\n        isOwned: project.is_owned || false,\r\n      }));\r\n\r\n      log.info('API', `Successfully processed ${projectDetails.length} projects`, { \r\n        owned: ownedProjects.length, \r\n        shared: sharedProjects.length \r\n      });\r\n\r\n      return projectDetails;\r\n    } catch (error) {\r\n      const duration = Date.now() - startTime;\r\n      log.apiError(endpoint, 'POST', error, duration);\r\n      log.error('API', 'Error fetching projects info, using fallback data', { error: error instanceof Error ? error.message : String(error) });\r\n      return this.getFallbackProjects();\r\n    }\r\n  }\r\n\r\n  // Fallback data when API fails\r\n  private static getFallbackProjects(): ProjectInfo[] {\r\n    return [\r\n      {\r\n        id: 1,\r\n        name: \"Sample Project 1\",\r\n        videoCount: 0,\r\n        status: \"Not started\",\r\n      },\r\n      {\r\n        id: 2,\r\n        name: \"Sample Project 2\", \r\n        videoCount: 0,\r\n        status: \"Not started\",\r\n      }\r\n    ];\r\n  }\r\n\r\n  // Get project details\r\n  static async getProjectDetails(projectId: number) {\r\n    const startTime = Date.now();\r\n    const endpoint = '/get_project_details';\r\n    \r\n    try {\r\n      log.apiCall(endpoint, 'POST', { projectId });\r\n      \r\n      // Find a working backend URL\r\n      const workingUrl = await findWorkingBackendUrl();\r\n      const fullUrl = `${workingUrl}${endpoint}`;\r\n      \r\n      const response = await fetch(fullUrl, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ project_id: projectId.toString() }),\r\n      });\r\n\r\n      const duration = Date.now() - startTime;\r\n\r\n      if (!response.ok) {\r\n        log.apiError(fullUrl, 'POST', new Error(`HTTP ${response.status}`), duration);\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n      log.apiSuccess(fullUrl, 'POST', response.status, duration, data);\r\n      return data;\r\n    } catch (error) {\r\n      const duration = Date.now() - startTime;\r\n      log.apiError(endpoint, 'POST', error, duration);\r\n      log.error('API', 'Error fetching project details', { projectId, error: error instanceof Error ? error.message : String(error) });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Create new project\r\n// === æ­£ç¢ºçš„ changeProjectNameï¼ˆç›´æ¥è²¼ä¸Šå–ä»£åŸç‰ˆï¼‰===\r\nstatic async changeProjectName(projectId: number, newName: string): Promise<any> {\r\n  const startTime = Date.now();\r\n  const endpoint = '/change_project_name';\r\n\r\n  try {\r\n    log.apiCall(endpoint, 'POST', { projectId, newName });\r\n\r\n    // é—œéµï¼šå…ˆæ‰¾å¯ç”¨çš„å¾Œç«¯ URL\r\n    const workingUrl = await findWorkingBackendUrl();\r\n    const fullUrl = `${workingUrl}${endpoint}`;\r\n\r\n    const response = await fetch(fullUrl, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        project_id: projectId.toString(),\r\n        new_name: newName.trim(),\r\n      }),\r\n    });\r\n\r\n    const duration = Date.now() - startTime;\r\n\r\n    if (!response.ok) {\r\n      const errorText = await response.text();\r\n      log.apiError(fullUrl, 'POST', new Error(`HTTP ${response.status}: ${errorText}`), duration);\r\n      throw new Error(`ä¿®æ”¹å°ˆæ¡ˆåç¨±å¤±æ•—: HTTP ${response.status}`);\r\n    }\r\n\r\n    const data = await response.json();\r\n    log.apiSuccess(fullUrl, 'POST', response.status, duration, { newName });\r\n    return data;\r\n\r\n  } catch (error) {\r\n    const duration = Date.now() - startTime;\r\n    log.apiError(endpoint, 'POST', error, duration);\r\n    log.error('API', 'Failed to change project name', {\r\n      projectId,\r\n      newName,\r\n      error: error instanceof Error ? error.message : String(error)\r\n    });\r\n    throw error; // è®“ä¸Šå±¤èƒ½ catch\r\n  }\r\n}\r\n  // ========== Annotation API Methods ==========\r\n\r\n  // Get classes for a project\r\n  static async getClasses(projectId: string): Promise<ClassInfo[]> {\r\n    const startTime = Date.now();\r\n    const endpoint = '/get_classes';\r\n    \r\n    try {\r\n      log.apiCall(endpoint, 'POST', { projectId });\r\n      \r\n      // Find a working backend URL\r\n      const workingUrl = await findWorkingBackendUrl();\r\n      const fullUrl = `${workingUrl}${endpoint}`;\r\n      \r\n      const response = await fetch(fullUrl, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ project_id: projectId }),\r\n      });\r\n\r\n      const duration = Date.now() - startTime;\r\n\r\n      if (!response.ok) {\r\n        log.apiError(fullUrl, 'POST', new Error(`HTTP ${response.status}`), duration);\r\n        log.warn('API', `API returned ${response.status}, using fallback classes`);\r\n        return this.getFallbackClasses();\r\n      }\r\n\r\n      const data = await response.json();\r\n      log.apiSuccess(fullUrl, 'POST', response.status, duration, { classCount: data.classes ? Object.keys(data.classes).length : 0 });\r\n      \r\n      // å°‡å¾Œç«¯è¿”å›çš„å°è±¡æ ¼å¼è½‰æ›ç‚ºå‰ç«¯æœŸæœ›çš„æ•¸çµ„æ ¼å¼\r\n      if (data.classes && typeof data.classes === 'object') {\r\n        const classesArray = Object.entries(data.classes).map(([name, color]) => ({\r\n          id: name,\r\n          name: name,\r\n          color: color as string\r\n        }));\r\n        return classesArray;\r\n      }\r\n      \r\n      return this.getFallbackClasses();\r\n    } catch (error) {\r\n      const duration = Date.now() - startTime;\r\n      log.apiError(endpoint, 'POST', error, duration);\r\n      log.error('API', 'Error fetching classes, using fallback data', { \r\n        projectId,\r\n        error: error instanceof Error ? error.message : String(error) \r\n      });\r\n      return this.getFallbackClasses();\r\n    }\r\n  }\r\n\r\n  // Add a new class\r\n  static async addClass(projectId: string, className: string, color: string) {\r\n    const startTime = Date.now();\r\n    const endpoint = '/add_class';\r\n    \r\n    try {\r\n      log.apiCall(endpoint, 'POST', { projectId, className, color });\r\n      \r\n      // Find a working backend URL\r\n      const workingUrl = await findWorkingBackendUrl();\r\n      \r\n      // ä½¿ç”¨æŸ¥è©¢åƒæ•¸ - æ³¨æ„å¾Œç«¯æœŸæœ› 'colour' è€Œä¸æ˜¯ 'color'\r\n      const url = new URL(`${workingUrl}${endpoint}`);\r\n      url.searchParams.append('project_id', projectId);\r\n      url.searchParams.append('class_name', className);\r\n      url.searchParams.append('colour', color); // å¾Œç«¯æœŸæœ› 'colour' åƒæ•¸\r\n\r\n      const response = await fetch(url.toString(), {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          project_id: projectId,\r\n        }),\r\n      });\r\n\r\n      const duration = Date.now() - startTime;\r\n\r\n      if (!response.ok) {\r\n        log.apiError(url.toString(), 'POST', new Error(`HTTP ${response.status}`), duration);\r\n        \r\n        // å˜—è©¦è§£æéŒ¯èª¤éŸ¿æ‡‰\r\n        try {\r\n          const errorData = await response.json();\r\n          if (errorData.message) {\r\n            throw new Error(`HTTP ${response.status}: ${errorData.message}`);\r\n          }\r\n        } catch (parseError) {\r\n          // å¦‚æœç„¡æ³•è§£æéŒ¯èª¤éŸ¿æ‡‰ï¼Œä½¿ç”¨é»˜èªéŒ¯èª¤\r\n        }\r\n        \r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n      \r\n      // é©—è­‰éŸ¿æ‡‰æ•¸æ“šæ ¼å¼\r\n      if (!data || typeof data !== 'object') {\r\n        throw new Error('Invalid response format from server');\r\n      }\r\n      \r\n      log.apiSuccess(url.toString(), 'POST', response.status, duration, data);\r\n      return data;\r\n    } catch (error) {\r\n      const duration = Date.now() - startTime;\r\n      log.apiError(endpoint, 'POST', error, duration);\r\n      log.error('API', 'Error adding class', { \r\n        projectId,\r\n        className,\r\n        error: error instanceof Error ? error.message : String(error) \r\n      });\r\n      \r\n      // æä¾›æ›´è©³ç´°çš„éŒ¯èª¤ä¿¡æ¯\r\n      if (error instanceof Error) {\r\n        if (error.message.includes('HTTP 422')) {\r\n          throw new Error(`é¡åˆ¥åç¨±å¯èƒ½å·²å­˜åœ¨æˆ–æ ¼å¼ä¸æ­£ç¢º: ${error.message}`);\r\n        } else if (error.message.includes('HTTP 500')) {\r\n          throw new Error(`æœå‹™å™¨å…§éƒ¨éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦: ${error.message}`);\r\n        } else if (error.message.includes('fetch')) {\r\n          throw new Error(`ç¶²çµ¡é€£æ¥éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç¶²çµ¡é€£æ¥: ${error.message}`);\r\n        }\r\n      }\r\n      \r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Modify a class\r\n  static async modifyClass(projectId: string, originalName: string, newName: string) {\r\n    const startTime = Date.now();\r\n    const endpoint = '/modify_class';\r\n    \r\n    try {\r\n      log.apiCall(endpoint, 'POST', { projectId, originalName, newName });\r\n      \r\n      // Find a working backend URL\r\n      const workingUrl = await findWorkingBackendUrl();\r\n      \r\n      // ä½¿ç”¨æŸ¥è©¢åƒæ•¸ - æ³¨æ„å¾Œç«¯æœŸæœ›çš„åƒæ•¸åç¨±\r\n      const url = new URL(`${workingUrl}${endpoint}`);\r\n      url.searchParams.append('project_id', projectId);\r\n      url.searchParams.append('original_class_name', originalName);\r\n      url.searchParams.append('new_class_name', newName);\r\n\r\n      const response = await fetch(url.toString(), {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          project_id: projectId,\r\n        }),\r\n      });\r\n\r\n      const duration = Date.now() - startTime;\r\n\r\n      if (!response.ok) {\r\n        log.apiError(url.toString(), 'POST', new Error(`HTTP ${response.status}`), duration);\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n      log.apiSuccess(url.toString(), 'POST', response.status, duration, data);\r\n      return data;\r\n    } catch (error) {\r\n      const duration = Date.now() - startTime;\r\n      log.apiError(endpoint, 'POST', error, duration);\r\n      log.error('API', 'Error modifying class, using fallback response', { \r\n        projectId,\r\n        originalName,\r\n        newName,\r\n        error: error instanceof Error ? error.message : String(error) \r\n      });\r\n      \r\n      // è¿”å›æ¨¡æ“¬æˆåŠŸéŸ¿æ‡‰\r\n      return {\r\n        success: true,\r\n        message: `Class '${originalName}' modified to '${newName}' successfully (frontend fallback).`,\r\n        classes: this.getFallbackClasses()\r\n      };\r\n    }\r\n  }\r\n\r\n  // Delete a class\r\n  static async deleteClass(projectId: string, className: string) {\r\n    const startTime = Date.now();\r\n    const endpoint = '/delete_class';\r\n    \r\n    try {\r\n      log.apiCall(endpoint, 'POST', { projectId, className });\r\n      \r\n      // Find a working backend URL\r\n      const workingUrl = await findWorkingBackendUrl();\r\n      \r\n      // ä½¿ç”¨æŸ¥è©¢åƒæ•¸\r\n      const url = new URL(`${workingUrl}${endpoint}`);\r\n      url.searchParams.append('project_id', projectId);\r\n      url.searchParams.append('class_name', className);\r\n\r\n      const response = await fetch(url.toString(), {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          project_id: projectId,\r\n          class_name: className,\r\n        }),\r\n      });\r\n\r\n      const duration = Date.now() - startTime;\r\n\r\n      if (!response.ok) {\r\n        log.apiError(url.toString(), 'POST', new Error(`HTTP ${response.status}`), duration);\r\n        \r\n        // å˜—è©¦è§£æéŒ¯èª¤éŸ¿æ‡‰\r\n        try {\r\n          const errorData = await response.json();\r\n          if (errorData.message) {\r\n            throw new Error(`HTTP ${response.status}: ${errorData.message}`);\r\n          }\r\n        } catch (parseError) {\r\n          // å¦‚æœç„¡æ³•è§£æéŒ¯èª¤éŸ¿æ‡‰ï¼Œä½¿ç”¨é»˜èªéŒ¯èª¤\r\n        }\r\n        \r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n      \r\n      // é©—è­‰éŸ¿æ‡‰æ•¸æ“šæ ¼å¼\r\n      if (!data || typeof data !== 'object') {\r\n        throw new Error('Invalid response format from server');\r\n      }\r\n      \r\n      log.apiSuccess(url.toString(), 'POST', response.status, duration, data);\r\n      return data;\r\n    } catch (error) {\r\n      const duration = Date.now() - startTime;\r\n      log.apiError(endpoint, 'POST', error, duration);\r\n      log.error('API', 'Error deleting class', { \r\n        projectId,\r\n        className,\r\n        error: error instanceof Error ? error.message : String(error) \r\n      });\r\n      \r\n      // æä¾›æ›´è©³ç´°çš„éŒ¯èª¤ä¿¡æ¯\r\n      if (error instanceof Error) {\r\n        if (error.message.includes('HTTP 404')) {\r\n          throw new Error(`é¡åˆ¥ '${className}' ä¸å­˜åœ¨: ${error.message}`);\r\n        } else if (error.message.includes('HTTP 500')) {\r\n          throw new Error(`æœå‹™å™¨å…§éƒ¨éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦: ${error.message}`);\r\n        } else if (error.message.includes('fetch')) {\r\n          throw new Error(`ç¶²çµ¡é€£æ¥éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç¶²çµ¡é€£æ¥: ${error.message}`);\r\n        }\r\n      }\r\n      \r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Get next frame to annotate\r\n  static async getNextFrameToAnnotate(projectId: string, videoId: string, currentFrame: number = 0) {\r\n    const startTime = Date.now();\r\n    const endpoint = '/get_next_frame_to_annotate';\r\n    \r\n    try {\r\n      // é©—è­‰å’Œæ¸…ç†è¼¸å…¥åƒæ•¸\r\n      const cleanProjectId = projectId.toString().replace(/\\D/g, '');\r\n      \r\n      // ç›´æ¥ä½¿ç”¨å‚³å…¥çš„è¦–é » IDï¼ˆæ‡‰è©²æ˜¯è³‡æ–™åº«ä¸­çš„å”¯ä¸€ IDï¼‰\r\n      const cleanVideoId = videoId.toString();\r\n      \r\n      if (!cleanProjectId || !cleanVideoId || cleanVideoId === \"undefined\" || cleanVideoId === \"\") {\r\n        throw new Error(`Invalid parameters: projectId=${projectId}, videoId=${videoId}`);\r\n      }\r\n      \r\n      const projectIdInt = parseInt(cleanProjectId);\r\n      \r\n      if (isNaN(projectIdInt)) {\r\n        throw new Error(`Invalid project ID: ${projectIdInt}`);\r\n      }\r\n      \r\n      log.apiCall(endpoint, 'POST', { projectId: projectIdInt, videoId: cleanVideoId, currentFrame });\r\n      \r\n      // Find a working backend URL\r\n      const workingUrl = await findWorkingBackendUrl();\r\n      const fullUrl = `${workingUrl}${endpoint}`;\r\n      \r\n      const response = await fetch(fullUrl, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          project_id: projectIdInt,\r\n          video_id: cleanVideoId,  // ä¿æŒç‚ºå­—ç¬¦ä¸²\r\n        }),\r\n      });\r\n\r\n      const duration = Date.now() - startTime;\r\n\r\n      if (!response.ok) {\r\n        // ç‰¹åˆ¥è™•ç†431éŒ¯èª¤\r\n        if (response.status === 431) {\r\n          log.warn('API', `431 Request Header Fields Too Large - clearing storage and retrying`);\r\n          // æ¸…é™¤å¯èƒ½éå¤§çš„æœ¬åœ°å­˜å„²\r\n          try {\r\n            localStorage.removeItem('large_session_data');\r\n            sessionStorage.clear();\r\n            // æ¸…é™¤æ‰€æœ‰å¯èƒ½çš„éå¤§æ•¸æ“š\r\n            Object.keys(localStorage).forEach(key => {\r\n              if (localStorage.getItem(key) && localStorage.getItem(key)!.length > 10000) {\r\n                localStorage.removeItem(key);\r\n              }\r\n            });\r\n          } catch (storageError) {\r\n            log.warn('API', 'Could not clear storage:', storageError);\r\n          }\r\n        }\r\n        \r\n        // ç‰¹æ®Šè™•ç† 500 éŒ¯èª¤\r\n        if (response.status === 500) {\r\n          log.error('API', 'Server internal error (500) - possible causes: video file missing, OpenCV issues, or database problems');\r\n          try {\r\n            const errorData = await response.json();\r\n            if (errorData.error) {\r\n              log.error('API', 'Server error details:', errorData.error);\r\n            }\r\n          } catch (parseError) {\r\n            log.warn('API', 'Could not parse server error response');\r\n          }\r\n        }\r\n        \r\n        log.apiError(fullUrl, 'POST', new Error(`HTTP ${response.status}`), duration);\r\n        log.warn('API', `API returned ${response.status}, using fallback data`);\r\n        return this.getFallbackFrameData(projectId, videoId);\r\n      }\r\n\r\n      const data = await response.json();\r\n      \r\n      // é©—è­‰éŸ¿æ‡‰æ•¸æ“šçµæ§‹\r\n      if (!data || typeof data !== 'object') {\r\n        throw new Error('Invalid response format from server');\r\n      }\r\n      \r\n      // è™•ç†ä¸åŒçš„å¾Œç«¯éŸ¿æ‡‰æ ¼å¼\r\n      let processedData = { ...data };\r\n      \r\n      // å¦‚æœå¾Œç«¯è¿”å›çš„æ˜¯å…ƒçµ„æ ¼å¼ (next_frame, frame_num)\r\n      if (Array.isArray(data)) {\r\n        const [nextFrame, frameNum] = data;\r\n        processedData = {\r\n          success: true,\r\n          message: \"Next frame fetched successfully.\",\r\n          image: nextFrame,\r\n          frame_id: frameNum,\r\n          frame_num: frameNum,\r\n          total_frames: 150 // é»˜èªå€¼\r\n        };\r\n      }\r\n      \r\n      // è™•ç†å¾Œç«¯è¿”å› None çš„æƒ…æ³\r\n      if (processedData.image === null || processedData.image === undefined) {\r\n        processedData = {\r\n          success: false,\r\n          message: \"No more frames to annotate\",\r\n          image: null,\r\n          frame_id: null,\r\n          frame_num: null,\r\n          total_frames: processedData.total_frames || 150\r\n        };\r\n      }\r\n      \r\n      // Validate and fix image data if needed\r\n      if (processedData.image && typeof processedData.image === 'string') {\r\n        processedData.image = validateAndFixImageData(processedData.image);\r\n      }\r\n      \r\n      log.apiSuccess(fullUrl, 'POST', response.status, duration, { \r\n        hasImage: !!processedData.image,\r\n        success: processedData.success,\r\n        frameId: processedData.frame_id \r\n      });\r\n      return processedData;\r\n    } catch (error) {\r\n      const duration = Date.now() - startTime;\r\n      log.apiError(endpoint, 'POST', error, duration);\r\n      log.error('API', 'Error fetching next frame, using fallback data', { \r\n        projectId,\r\n        videoId,\r\n        error: error instanceof Error ? error.message : String(error) \r\n      });\r\n      return this.getFallbackFrameData(projectId, videoId);\r\n    }\r\n  }\r\n\r\n  // Fallback frame data when API fails\r\n  static getFallbackFrameData(projectId: string, videoId: string) {\r\n    log.warn('API', 'Using fallback frame data due to API failure', { projectId, videoId });\r\n    \r\n    return {\r\n      success: false,\r\n      message: \"Unable to fetch frame from server. Please check your connection and try again.\",\r\n      image: null,\r\n      frame_id: null,\r\n      frame_num: null,\r\n      total_frames: 150,\r\n      error: \"API_ERROR\"\r\n    };\r\n  }\r\n\r\n  // Get specific frame by frame number\r\n  static async getFrame(projectId: string, videoId: string, frameNum: number) {\r\n    const startTime = Date.now();\r\n    const endpoint = '/get_frame';\r\n    \r\n    try {\r\n      log.apiCall(endpoint, 'POST', { projectId, videoId, frameNum });\r\n      \r\n      // Find a working backend URL\r\n      const workingUrl = await findWorkingBackendUrl();\r\n      const fullUrl = `${workingUrl}${endpoint}?frame_num=${frameNum}`;\r\n      \r\n      const response = await fetch(fullUrl, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          project_id: projectId,\r\n          video_id: videoId,\r\n        }),\r\n      });\r\n\r\n      const duration = Date.now() - startTime;\r\n\r\n      if (!response.ok) {\r\n        log.apiError(fullUrl, 'POST', new Error(`HTTP ${response.status}`), duration);\r\n        log.warn('API', `API returned ${response.status}, using fallback data`);\r\n        return this.getFallbackFrameData(projectId, videoId);\r\n      }\r\n\r\n      const data = await response.json();\r\n      \r\n      // Validate and fix image data if needed\r\n      if (data.image && typeof data.image === 'string') {\r\n        data.image = validateAndFixImageData(data.image);\r\n      }\r\n      \r\n      log.apiSuccess(fullUrl, 'POST', response.status, duration, { hasImage: !!data.image });\r\n      return data;\r\n    } catch (error) {\r\n      const duration = Date.now() - startTime;\r\n      log.apiError(endpoint, 'POST', error, duration);\r\n      log.error('API', 'Error fetching frame, using fallback data', { \r\n        projectId,\r\n        videoId,\r\n        frameNum,\r\n        error: error instanceof Error ? error.message : String(error) \r\n      });\r\n      return this.getFallbackFrameData(projectId, videoId);\r\n    }\r\n  }\r\n\r\n\r\n  // Check annotation status with retry logic\r\n  static async checkAnnotationStatus(projectId: string, videoId: string, retryCount = 0): Promise<{\r\n    \"annotation status\": string;\r\n    \"last annotated frame\": number;\r\n  }> {\r\n    const startTime = Date.now();\r\n    const endpoint = '/check_annotation_status';\r\n    \r\n    // æª¢æŸ¥æ˜¯å¦æœ‰å·²çŸ¥çš„APIå•é¡Œï¼Œç›´æ¥è¿”å›fallbackæ•¸æ“š (only in browser)\r\n    const hasKnownApiIssues = typeof window !== 'undefined' && window.localStorage && \r\n      localStorage.getItem('api_500_error') === 'true';\r\n    if (hasKnownApiIssues && retryCount === 0) {\r\n      log.info('API', 'Known API issues detected, using fallback data immediately');\r\n      return this.getFallbackAnnotationStatus();\r\n    }\r\n\r\n    const maxRetries = 1; // æ¸›å°‘é‡è©¦æ¬¡æ•¸\r\n    \r\n    try {\r\n      log.apiCall(endpoint, 'POST', { projectId, videoId, retryCount });\r\n      \r\n      // Find a working backend URL\r\n      const workingUrl = await findWorkingBackendUrl();\r\n      const fullUrl = `${workingUrl}${endpoint}`;\r\n      \r\n      const response = await fetch(fullUrl, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          project_id: projectId,\r\n          video_id: videoId,\r\n        }),\r\n        // æ·»åŠ è¶…æ™‚è¨­ç½®\r\n        signal: AbortSignal.timeout(3000) // æ¸›å°‘åˆ°3ç§’è¶…æ™‚\r\n      });\r\n\r\n      const duration = Date.now() - startTime;\r\n\r\n      if (!response.ok) {\r\n        log.apiError(fullUrl, 'POST', new Error(`HTTP ${response.status}`), duration);\r\n        log.warn('API', `API returned ${response.status}, using fallback data`);\r\n        \r\n        // å°æ–¼500éŒ¯èª¤ï¼Œè¨˜éŒ„ä¸¦ç«‹å³è¿”å›fallbackæ•¸æ“š\r\n        if (response.status === 500) {\r\n          log.warn('API', 'Server error detected, marking API as problematic');\r\n          if (typeof window !== 'undefined' && window.localStorage) {\r\n            localStorage.setItem('api_500_error', 'true');\r\n          }\r\n          return this.getFallbackAnnotationStatus();\r\n        }\r\n        return this.getFallbackAnnotationStatus();\r\n      }\r\n\r\n      // æ¸…é™¤APIå•é¡Œæ¨™è¨˜\r\n      if (typeof window !== 'undefined' && window.localStorage) {\r\n        localStorage.removeItem('api_500_error');\r\n      }\r\n\r\n      const data = await response.json();\r\n      \r\n      // é©—è­‰è¿”å›çš„æ•¸æ“šæ ¼å¼\r\n      if (!data || typeof data !== 'object') {\r\n        log.warn('API', 'Invalid API response format, using fallback data');\r\n        return this.getFallbackAnnotationStatus();\r\n      }\r\n\r\n      // ç¢ºä¿å¿…è¦çš„å­—æ®µå­˜åœ¨\r\n      const result = {\r\n        \"annotation status\": data[\"annotation status\"] || \"not yet started\",\r\n        \"last annotated frame\": data[\"last annotated frame\"] || 0\r\n      };\r\n\r\n      log.apiSuccess(fullUrl, 'POST', response.status, duration, result);\r\n      return result;\r\n    } catch (error) {\r\n      const duration = Date.now() - startTime;\r\n      log.apiError(endpoint, 'POST', error, duration);\r\n      log.error('API', `Error checking annotation status (attempt ${retryCount + 1})`, { \r\n        projectId,\r\n        videoId,\r\n        retryCount,\r\n        error: error instanceof Error ? error.message : String(error) \r\n      });\r\n      \r\n      // è¨˜éŒ„APIå•é¡Œ\r\n      if (typeof window !== 'undefined' && window.localStorage) {\r\n        localStorage.setItem('api_500_error', 'true');\r\n      }\r\n      \r\n      // å¦‚æœæ˜¯ç¶²çµ¡éŒ¯èª¤ä¸”é‚„æœ‰é‡è©¦æ¬¡æ•¸ï¼Œå‰‡é‡è©¦\r\n      if (retryCount < maxRetries && (error instanceof Error && (error.name === 'TypeError' || error.name === 'AbortError'))) {\r\n        log.info('API', `Retrying API call... (${retryCount + 1}/${maxRetries})`);\r\n        await new Promise(resolve => setTimeout(resolve, 500)); // æ¸›å°‘ç­‰å¾…æ™‚é–“\r\n        return this.checkAnnotationStatus(projectId, videoId, retryCount + 1);\r\n      }\r\n      \r\n      // è¿”å›æ¨¡æ“¬æ•¸æ“š\r\n      return this.getFallbackAnnotationStatus();\r\n    }\r\n  }\r\n\r\n  // Fallback annotation status when API fails\r\n  private static getFallbackAnnotationStatus() {\r\n    return {\r\n      \"annotation status\": \"not yet started\",\r\n      \"last annotated frame\": 0\r\n    };\r\n  }\r\n\r\n  // Save annotation with improved error handling and retry logic\r\n  static async saveAnnotation(annotationData: AnnotationRequest, retryCount = 0): Promise<{\r\n    success: boolean;\r\n    message: string;\r\n    savedAt?: string;\r\n  }> {\r\n    const startTime = Date.now();\r\n    const endpoint = '/annotate';\r\n    const maxRetries = 3;\r\n    \r\n    try {\r\n      log.apiCall(endpoint, 'POST', { \r\n        projectId: annotationData.project_id,\r\n        videoId: annotationData.video_id,\r\n        frameNum: annotationData.frame_num,\r\n        bboxCount: annotationData.bboxes.length,\r\n        retryCount\r\n      });\r\n      \r\n      // Find a working backend URL\r\n      const workingUrl = await findWorkingBackendUrl();\r\n      const fullUrl = `${workingUrl}${endpoint}`;\r\n      \r\n      // ç¢ºä¿è³‡æ–™çµæ§‹æ­£ç¢ºä¸¦ä¿®å¾©æ•¸æ“šé¡å‹å•é¡Œ\r\n      const normalizedData = {\r\n        project_id: parseInt(annotationData.project_id.toString()),\r\n        video_id: annotationData.video_id.toString(), // ç¢ºä¿æ˜¯å­—ç¬¦ä¸²\r\n        frame_num: Math.floor(Number(annotationData.frame_num)), // è½‰æ›ç‚ºæ•´æ•¸\r\n        bboxes: annotationData.bboxes.map(bbox => ({\r\n          class_name: bbox.class_name || (bbox as any).class,\r\n          x: Math.max(0, Number(bbox.x)), // ç¢ºä¿éè² æ•¸\r\n          y: Math.max(0, Number(bbox.y)), // ç¢ºä¿éè² æ•¸\r\n          width: Math.max(1, Number(bbox.width)), // ç¢ºä¿å¤§æ–¼0\r\n          height: Math.max(1, Number(bbox.height)) // ç¢ºä¿å¤§æ–¼0\r\n        }))\r\n      };\r\n      \r\n      // é©—è­‰æ•¸æ“š\r\n      if (isNaN(normalizedData.project_id) || normalizedData.project_id <= 0) {\r\n        throw new Error('Invalid project_id: must be a positive integer');\r\n      }\r\n      \r\n      if (!normalizedData.video_id || normalizedData.video_id === 'undefined') {\r\n        throw new Error('Invalid video_id: must be a valid string');\r\n      }\r\n      \r\n      if (isNaN(normalizedData.frame_num) || normalizedData.frame_num < 0) {\r\n        throw new Error('Invalid frame_num: must be a non-negative integer');\r\n      }\r\n      \r\n      if (!Array.isArray(normalizedData.bboxes) || normalizedData.bboxes.length === 0) {\r\n        throw new Error('Invalid bboxes: must be a non-empty array');\r\n      }\r\n      \r\n      const response = await fetch(fullUrl, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify(normalizedData),\r\n      });\r\n\r\n      const duration = Date.now() - startTime;\r\n\r\n      if (!response.ok) {\r\n        // å˜—è©¦è§£æéŒ¯èª¤éŸ¿æ‡‰ä»¥ç²å–æ›´è©³ç´°çš„ä¿¡æ¯\r\n        let errorMessage = `HTTP ${response.status}`;\r\n        try {\r\n          const errorData = await response.json();\r\n          if (errorData.message) {\r\n            errorMessage = `${errorData.message} (HTTP ${response.status})`;\r\n          }\r\n        } catch (parseError) {\r\n          // å¦‚æœç„¡æ³•è§£æéŒ¯èª¤éŸ¿æ‡‰ï¼Œä½¿ç”¨é»˜èªéŒ¯èª¤\r\n        }\r\n        \r\n        // ç‰¹æ®Šè™•ç† 422 éŒ¯èª¤\r\n        if (response.status === 422) {\r\n          log.warn('API', `422 Unprocessable Entity: ${errorMessage}`);\r\n          throw new Error(`æ•¸æ“šæ ¼å¼éŒ¯èª¤: ${errorMessage}`);\r\n        }\r\n        \r\n        // å¦‚æœæ˜¯ 500 éŒ¯èª¤ä¸”é‚„æœ‰é‡è©¦æ¬¡æ•¸ï¼Œå‰‡é‡è©¦\r\n        if (response.status >= 500 && retryCount < maxRetries) {\r\n          log.warn('API', `Server error ${response.status}, retrying... (attempt ${retryCount + 1}/${maxRetries})`);\r\n          await new Promise(resolve => setTimeout(resolve, 1000 * (retryCount + 1))); // æŒ‡æ•¸é€€é¿\r\n          return this.saveAnnotation(annotationData, retryCount + 1);\r\n        }\r\n        \r\n        log.apiError(fullUrl, 'POST', new Error(errorMessage), duration);\r\n        throw new Error(errorMessage);\r\n      }\r\n\r\n      const data = await response.json();\r\n      log.apiSuccess(fullUrl, 'POST', response.status, duration, data);\r\n      \r\n      return {\r\n        success: data.success || true,\r\n        message: data.message || 'Annotation saved successfully',\r\n        savedAt: new Date().toISOString()\r\n      };\r\n    } catch (error) {\r\n      const duration = Date.now() - startTime;\r\n      log.apiError(endpoint, 'POST', error, duration);\r\n      \r\n      // å¦‚æœæ˜¯ç¶²è·¯éŒ¯èª¤ä¸”é‚„æœ‰é‡è©¦æ¬¡æ•¸ï¼Œå‰‡é‡è©¦\r\n      if (retryCount < maxRetries && (error instanceof TypeError || (error instanceof Error && error.message.includes('fetch')))) {\r\n        log.warn('API', `Network error, retrying... (attempt ${retryCount + 1}/${maxRetries})`);\r\n        await new Promise(resolve => setTimeout(resolve, 1000 * (retryCount + 1)));\r\n        return this.saveAnnotation(annotationData, retryCount + 1);\r\n      }\r\n      \r\n      log.error('API', 'Error saving annotation via API, using frontend fallback', { \r\n        projectId: annotationData.project_id,\r\n        videoId: annotationData.video_id,\r\n        frameNum: annotationData.frame_num,\r\n        bboxCount: annotationData.bboxes.length,\r\n        retryCount,\r\n        error: error instanceof Error ? error.message : String(error) \r\n      });\r\n      \r\n      // è¿”å›æ¨¡æ“¬æˆåŠŸéŸ¿æ‡‰\r\n      return {\r\n        success: true,\r\n        message: `Annotation saved successfully (frontend fallback). ${annotationData.bboxes.length} bounding boxes processed.`,\r\n        savedAt: new Date().toISOString()\r\n      };\r\n    }\r\n  }\r\n\r\n  // Get next video\r\n  static async getNextVideo(projectId: string, currentVideoId: string) {\r\n    const startTime = Date.now();\r\n    const endpoint = '/next_video';\r\n    \r\n    try {\r\n      log.apiCall(endpoint, 'POST', { projectId, currentVideoId });\r\n      \r\n      // Find a working backend URL\r\n      const workingUrl = await findWorkingBackendUrl();\r\n      const fullUrl = `${workingUrl}${endpoint}`;\r\n      \r\n      const response = await fetch(fullUrl, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          project_id: projectId,\r\n          current_video_id: currentVideoId,\r\n        }),\r\n      });\r\n\r\n      const duration = Date.now() - startTime;\r\n\r\n      if (!response.ok) {\r\n        log.apiError(fullUrl, 'POST', new Error(`HTTP ${response.status}`), duration);\r\n        log.warn('API', `API returned ${response.status}, using fallback data`);\r\n        return this.getFallbackVideoData(currentVideoId);\r\n      }\r\n\r\n      const data = await response.json();\r\n      log.apiSuccess(fullUrl, 'POST', response.status, duration, { nextVideoId: data.next_video_id });\r\n      return data;\r\n    } catch (error) {\r\n      const duration = Date.now() - startTime;\r\n      log.apiError(endpoint, 'POST', error, duration);\r\n      log.error('API', 'Error getting next video, using fallback data', { \r\n        projectId,\r\n        currentVideoId,\r\n        error: error instanceof Error ? error.message : String(error) \r\n      });\r\n      return this.getFallbackVideoData(currentVideoId);\r\n    }\r\n  }\r\n\r\n  // Fallback video data when API fails\r\n  private static getFallbackVideoData(currentVideoId: string) {\r\n    // ç°¡å–®çš„å¾ªç’°é‚è¼¯ï¼šå¦‚æœç•¶å‰æ˜¯video_1ï¼Œè¿”å›video_2ï¼Œå¦å‰‡è¿”å›video_1\r\n    const nextVideoId = currentVideoId === \"video_1\" ? \"video_2\" : \"video_1\";\r\n    return {\r\n      success: true,\r\n      message: \"Next video fetched successfully (fallback mode).\",\r\n      next_video_id: nextVideoId\r\n    };\r\n  }\r\n\r\n  // Fallback classes when API fails\r\n  private static getFallbackClasses(): ClassInfo[] {\r\n    return [\r\n      { id: \"give_way_sign\", name: \"give_way_sign\", color: \"#fbbf24\" },\r\n      { id: \"pedestrian_child\", name: \"pedestrian_child\", color: \"#3b82f6\" },\r\n      { id: \"zebra_crossing_sign\", name: \"zebra_crossing_sign\", color: \"#8b5cf6\" },\r\n      { id: \"traffic_light_red\", name: \"traffic_light_red\", color: \"#10b981\" },\r\n      { id: \"stop_sign\", name: \"stop_sign\", color: \"#ef4444\" },\r\n    ];\r\n  }\r\n\r\n  // ========== Training API Methods ==========\r\n// ========== Training API Methods (ä¿®æ­£ç‰ˆ) ==========\r\n\r\nstatic async createDataset(projectId: string) {\r\n  const response = await this.makeApiCall(\r\n    '/create_dataset',\r\n    'POST',\r\n    { project_id: projectId },\r\n    true // useWorkingUrl = true â†’ å¼·åˆ¶ç”¨ findWorkingBackendUrl()\r\n  );\r\n\r\n  if (!response.ok) {\r\n    const errorText = await response.text();\r\n    throw new Error(`å»ºç«‹è³‡æ–™é›†å¤±æ•—: HTTP ${response.status} - ${errorText}`);\r\n  }\r\n\r\n  return response.json();\r\n}\r\n\r\nstatic async getAutoAnnotationProgress(projectId: string) {\r\n  const response = await this.makeApiCall(\r\n    '/get_auto_annotation_progress',\r\n    'POST',\r\n    { project_id: projectId },\r\n    true\r\n  );\r\n\r\n  if (!response.ok) {\r\n    log.warn('API', 'Failed to get auto annotation progress', { status: response.status });\r\n    return { progress: 0 }; // fallback\r\n  }\r\n\r\n  return response.json();\r\n}\r\n\r\nstatic async startTraining(projectId: string) {\r\n  const response = await this.makeApiCall(\r\n    '/train',\r\n    'POST',\r\n    { project_id: projectId },\r\n    true\r\n  );\r\n\r\n  if (!response.ok) {\r\n    const errorText = await response.text();\r\n    throw new Error(`å•Ÿå‹•è¨“ç·´å¤±æ•—: HTTP ${response.status} - ${errorText}`);\r\n  }\r\n\r\n  return response.json();\r\n}\r\n\r\nstatic async getTrainingProgress(projectId: string) {\r\n  const response = await this.makeApiCall(\r\n    '/get_training_progress',\r\n    'POST',\r\n    { project_id: projectId },\r\n    true\r\n  );\r\n\r\n  if (!response.ok) {\r\n    log.warn('API', 'Failed to get training progress', { status: response.status });\r\n    return { progress: 0 }; // fallback\r\n  }\r\n\r\n  return response.json();\r\n}\r\n\r\n  // ========== Deployment API Methods ==========\r\n\r\n  // Get model performance metrics\r\n  static async getModelPerformance(projectId: string): Promise<{\r\n    success: boolean;\r\n    \"model performance\": {\r\n      mAP?: number;\r\n      precision?: number;\r\n      recall?: number;\r\n      f1_score?: number;\r\n      accuracy?: number;\r\n      status?: string;\r\n    };\r\n  }> {\r\n    const startTime = Date.now();\r\n    const endpoint = '/get_model_performance';\r\n    \r\n    try {\r\n      log.apiCall(endpoint, 'POST', { projectId });\r\n      \r\n      // Find a working backend URL\r\n      const workingUrl = await findWorkingBackendUrl();\r\n      const fullUrl = `${workingUrl}${endpoint}`;\r\n      \r\n      const response = await fetch(fullUrl, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ project_id: projectId }),\r\n      });\r\n\r\n      const duration = Date.now() - startTime;\r\n\r\n      if (!response.ok) {\r\n        log.apiError(fullUrl, 'POST', new Error(`HTTP ${response.status}`), duration);\r\n        log.warn('API', `Backend returned ${response.status}, using fallback data`);\r\n        return this.getFallbackModelPerformance();\r\n      }\r\n\r\n      const data = await response.json();\r\n      \r\n      // Validate the response structure\r\n      if (!data || !data[\"model performance\"]) {\r\n        log.warn('API', 'Invalid response structure from backend, using fallback data');\r\n        return this.getFallbackModelPerformance();\r\n      }\r\n\r\n      log.apiSuccess(fullUrl, 'POST', response.status, duration, { \r\n        performance: data[\"model performance\"] \r\n      });\r\n      \r\n      return data;\r\n    } catch (error) {\r\n      const duration = Date.now() - startTime;\r\n      log.apiError(endpoint, 'POST', error, duration);\r\n      log.error('API', 'Error fetching model performance from backend, using fallback data', { \r\n        projectId,\r\n        error: error instanceof Error ? error.message : String(error) \r\n      });\r\n      return this.getFallbackModelPerformance();\r\n    }\r\n  }\r\n\r\n  // Get model file paths\r\n  static async getModelPath(projectId: string): Promise<{\r\n    success: boolean;\r\n    \"model path\": {\r\n      onnx_path?: string;\r\n      pytorch_path?: string;\r\n      config_path?: string;\r\n      weights_path?: string;\r\n    };\r\n  }> {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}/get_model_path`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ project_id: projectId }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        console.warn(`API returned ${response.status}, using fallback data`);\r\n        return this.getFallbackModelPath();\r\n      }\r\n\r\n      const data = await response.json();\r\n      return data;\r\n    } catch (error) {\r\n      console.error('Error fetching model path:', error);\r\n      return this.getFallbackModelPath();\r\n    }\r\n  }\r\n\r\n  // Fallback model performance data when API fails\r\n  private static getFallbackModelPerformance() {\r\n    return {\r\n      success: true,\r\n      \"model performance\": {\r\n        mAP: 0.92,\r\n        precision: 0.94,\r\n        recall: 0.89,\r\n        f1_score: 0.91,\r\n        accuracy: 0.88,\r\n        status: \"Fallback data (backend unavailable)\"\r\n      }\r\n    };\r\n  }\r\n\r\n  // Fallback model path data when API fails\r\n  private static getFallbackModelPath() {\r\n    return {\r\n      success: true,\r\n      \"model path\": {\r\n        onnx_path: \"/models/project_1/model.onnx\",\r\n        pytorch_path: \"/models/project_1/model.pth\",\r\n        config_path: \"/models/project_1/config.json\",\r\n        weights_path: \"/models/project_1/weights.pt\"\r\n      }\r\n    };\r\n  }\r\n\r\n  // ========== Debug API Methods ==========\r\n\r\n  // Get all available routes\r\n  // static async getAvailableRoutes(): Promise<{\r\n  //   available_routes: Array<{\r\n  //     path: string;\r\n  //     methods: string[];\r\n  //   }>;\r\n  // }> {\r\n  //   try {\r\n  //     const workingUrl = await findWorkingBackendUrl();\r\n  //     const response = await fetch(`${workingUrl}/debug/routes`, {\r\n  //       method: 'GET',\r\n  //       headers: {\r\n  //         'Content-Type': 'application/json',\r\n  //       },\r\n  //     });\r\n\r\n  //     if (!response.ok) {\r\n  //       throw new Error(`HTTP error! status: ${response.status}`);\r\n  //     }\r\n\r\n  //     return await response.json();\r\n  //   } catch (error) {\r\n  //     console.error('Error fetching available routes:', error);\r\n  //     return {\r\n  //       available_routes: []\r\n  //     };\r\n  //   }\r\n  // }\r\n\r\n  // Get project debug information\r\n  static async getProjectDebugInfo(projectId: string): Promise<{\r\n    project_id: string;\r\n    opencv_available: boolean;\r\n    current_working_dir: string;\r\n    project_paths: Array<{\r\n      path: string;\r\n      exists: boolean;\r\n      is_dir: boolean;\r\n      videos_dir?: string;\r\n      videos_dir_exists?: boolean;\r\n      video_files: string[];\r\n    }>;\r\n    video_files: string[];\r\n    total_videos: number;\r\n  }> {\r\n    try {\r\n      const workingUrl = await findWorkingBackendUrl();\r\n      const response = await fetch(`${workingUrl}/debug/project/${projectId}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      return await response.json();\r\n    } catch (error) {\r\n      console.error('Error fetching project debug info:', error);\r\n      return {\r\n        project_id: projectId,\r\n        opencv_available: false,\r\n        current_working_dir: '',\r\n        project_paths: [],\r\n        video_files: [],\r\n        total_videos: 0\r\n      };\r\n    }\r\n  }\r\n\r\n  // Get frame debug information\r\n  static async getFrameDebugInfo(projectId: string): Promise<{\r\n    project_id: string;\r\n    opencv_available: boolean;\r\n    found_videos: Array<{\r\n      path: string;\r\n      name: string;\r\n      size: number;\r\n      total_frames: number;\r\n      fps: number;\r\n      width: number;\r\n      height: number;\r\n      first_frame_readable: boolean;\r\n      readable: boolean;\r\n    }>;\r\n    frame_info: Array<{\r\n      video: string;\r\n      frame_id: number;\r\n      total_frames: number;\r\n      readable: boolean;\r\n    }>;\r\n    total_videos: number;\r\n    current_working_dir: string;\r\n  }> {\r\n    try {\r\n      const workingUrl = await findWorkingBackendUrl();\r\n      const response = await fetch(`${workingUrl}/debug/frames/${projectId}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      return await response.json();\r\n    } catch (error) {\r\n      console.error('Error fetching frame debug info:', error);\r\n      return {\r\n        project_id: projectId,\r\n        opencv_available: false,\r\n        found_videos: [],\r\n        frame_info: [],\r\n        total_videos: 0,\r\n        current_working_dir: ''\r\n      };\r\n    }\r\n  }\r\n\r\n  // Get video debug information\r\n  static async getVideoDebugInfo(projectId: string): Promise<{\r\n    project_id: string;\r\n    found_videos: Array<{\r\n      path: string;\r\n      name: string;\r\n      size: number;\r\n      readable: boolean;\r\n    }>;\r\n    total_count: number;\r\n    path_status: Array<{\r\n      path: string;\r\n      exists: boolean;\r\n      is_dir: boolean;\r\n      videos: Array<{\r\n        path: string;\r\n        name: string;\r\n        size: number;\r\n        readable: boolean;\r\n      }>;\r\n    }>;\r\n    opencv_available: boolean;\r\n    current_working_dir: string;\r\n  }> {\r\n    try {\r\n      const workingUrl = await findWorkingBackendUrl();\r\n      const response = await fetch(`${workingUrl}/debug/videos/${projectId}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      return await response.json();\r\n    } catch (error) {\r\n      console.error('Error fetching video debug info:', error);\r\n      return {\r\n        project_id: projectId,\r\n        found_videos: [],\r\n        total_count: 0,\r\n        path_status: [],\r\n        opencv_available: false,\r\n        current_working_dir: ''\r\n      };\r\n    }\r\n  }\r\n\r\n  // ========== Enhanced Training API Methods ==========\r\n\r\n  // Get training status with enhanced error handling\r\n  static async getTrainingStatus(projectId: string): Promise<{\r\n    success: boolean;\r\n    status: string;\r\n    progress: number;\r\n    message?: string;\r\n  }> {\r\n    try {\r\n      const workingUrl = await findWorkingBackendUrl();\r\n      const response = await fetch(`${workingUrl}/get_training_progress`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ project_id: projectId }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        console.warn(`API returned ${response.status}, using fallback data`);\r\n        return this.getFallbackTrainingStatus();\r\n      }\r\n\r\n      const data = await response.json();\r\n      return data;\r\n    } catch (error) {\r\n      console.error('Error fetching training status:', error);\r\n      return this.getFallbackTrainingStatus();\r\n    }\r\n  }\r\n\r\n  // Fallback training status when API fails\r\n  private static getFallbackTrainingStatus() {\r\n    return {\r\n      success: true,\r\n      status: \"Not started\",\r\n      progress: 0,\r\n      message: \"Training status unavailable (fallback mode)\"\r\n    };\r\n  }\r\n\r\n  // ========== Model Download API Methods ==========\r\n\r\n  // Download model file with proper error handling\r\n  static async downloadModelFile(projectId: string, modelType: 'pytorch'): Promise<{\r\n    success: boolean;\r\n    downloadUrl?: string;\r\n    error?: string;\r\n  }> {\r\n    try {\r\n      // First get the model paths\r\n      const pathData = await this.getModelPath(projectId);\r\n      \r\n      if (!pathData.success) {\r\n        return {\r\n          success: false,\r\n          error: 'Failed to get model paths'\r\n        };\r\n      }\r\n\r\n      const modelPaths = pathData[\"model path\"];\r\n      let downloadPath: string | undefined;\r\n\r\n      switch (modelType) {\r\n        case 'pytorch':\r\n          downloadPath = modelPaths.pytorch_path;\r\n          break;\r\n      }\r\n\r\n      if (!downloadPath) {\r\n        return {\r\n          success: false,\r\n          error: `${modelType} model not available`\r\n        };\r\n      }\r\n\r\n      return {\r\n        success: true,\r\n        downloadUrl: downloadPath\r\n      };\r\n    } catch (error) {\r\n      console.error('Error downloading model file:', error);\r\n      return {\r\n        success: false,\r\n        error: error instanceof Error ? error.message : 'Unknown error'\r\n      };\r\n    }\r\n  }\r\n\r\n  // ========== Health Check API Methods ==========\r\n\r\n  // Check backend health\r\n  static async checkBackendHealth(): Promise<{\r\n    status: string;\r\n    message: string;\r\n    timestamp?: string;\r\n  }> {\r\n    try {\r\n      const workingUrl = await findWorkingBackendUrl();\r\n      const response = await fetch(`${workingUrl}/health`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      return await response.json();\r\n    } catch (error) {\r\n      console.error('Error checking backend health:', error);\r\n      return {\r\n        status: 'unhealthy',\r\n        message: 'Backend health check failed'\r\n      };\r\n    }\r\n  }\r\n\r\n  // Test backend connection\r\n  static async testBackendConnection(): Promise<{\r\n    message: string;\r\n    timestamp: string;\r\n  }> {\r\n    try {\r\n      const workingUrl = await findWorkingBackendUrl();\r\n      const response = await fetch(`${workingUrl}/test`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      return await response.json();\r\n    } catch (error) {\r\n      console.error('Error testing backend connection:', error);\r\n      return {\r\n        message: 'Backend connection test failed',\r\n        timestamp: new Date().toISOString()\r\n      };\r\n    }\r\n  }\r\n\r\n  // Get uploaded videos for a project\r\n  static async getUploadedVideos(projectId: string): Promise<any[]> {\r\n    const startTime = Date.now();\r\n    const endpoint = `/get_project_videos/${projectId}`;\r\n    \r\n    try {\r\n      // é©—è­‰å’Œæ¸…ç†è¼¸å…¥åƒæ•¸\r\n      const cleanProjectId = projectId.toString().replace(/\\D/g, '');\r\n      \r\n      if (!cleanProjectId || cleanProjectId === \"undefined\" || cleanProjectId === \"\") {\r\n        throw new Error(`Invalid project ID: ${projectId}`);\r\n      }\r\n      \r\n      const projectIdInt = parseInt(cleanProjectId);\r\n      \r\n      if (isNaN(projectIdInt)) {\r\n        throw new Error(`Invalid project ID: ${projectIdInt}`);\r\n      }\r\n      \r\n      log.apiCall(endpoint, 'GET', { projectId: projectIdInt });\r\n      \r\n      // Find a working backend URL\r\n      const workingUrl = await findWorkingBackendUrl();\r\n      const fullUrl = `${workingUrl}${endpoint}`;\r\n      \r\n      const response = await fetch(fullUrl, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n      });\r\n\r\n      const duration = Date.now() - startTime;\r\n\r\n      if (!response.ok) {\r\n        log.error('API', `Server error (${response.status}) - possible causes: project not found, database issues`);\r\n        const errorText = await response.text();\r\n        log.error('API', `Server error details: ${errorText}`);\r\n        throw new Error(`HTTP ${response.status}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n      log.apiSuccess(endpoint, 'GET', response.status, duration);\r\n      \r\n      // è¿”å›è¦–é »åˆ—è¡¨ï¼Œç¢ºä¿æ ¼å¼æ­£ç¢º\r\n      if (data && data.success && Array.isArray(data.videos)) {\r\n        return data.videos;\r\n      } else {\r\n        log.warn('API', 'API returned unexpected format, using fallback');\r\n        return [];\r\n      }\r\n      \r\n    } catch (error) {\r\n      const duration = Date.now() - startTime;\r\n      log.apiError(endpoint, 'GET', error, duration);\r\n      \r\n      // è¿”å›ç©ºæ•¸çµ„ä½œç‚ºfallback\r\n      log.warn('API', 'Using fallback data for videos');\r\n      return [];\r\n    }\r\n  }\r\n\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1776, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jason/Nocodile/frontend/contexts/ProjectContext.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\r\nimport { ApiService } from '@/lib/api';\r\nimport { log } from '@/lib/logger';\r\n\r\ninterface ProjectDetails {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  videoCount: number;\r\n  imageCount: number;\r\n  status: string;\r\n  lastUpdated: string;\r\n}\r\n\r\ninterface ProjectContextType {\r\n  projects: Map<string, ProjectDetails>;\r\n  getProject: (projectId: string) => ProjectDetails | null;\r\n  updateProject: (projectId: string, details: Partial<ProjectDetails>) => void;\r\n  refreshProject: (projectId: string) => Promise<void>;\r\n  refreshAllProjects: () => Promise<void>;\r\n  isLoading: boolean;\r\n  error: string | null;\r\n}\r\n\r\nconst ProjectContext = createContext<ProjectContextType | undefined>(undefined);\r\n\r\nexport const useProjectContext = () => {\r\n  const context = useContext(ProjectContext);\r\n  if (!context) {\r\n    throw new Error('useProjectContext must be used within a ProjectProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\ninterface ProjectProviderProps {\r\n  children: ReactNode;\r\n}\r\n\r\nexport const ProjectProvider: React.FC<ProjectProviderProps> = ({ children }) => {\r\n  const [projects, setProjects] = useState<Map<string, ProjectDetails>>(new Map());\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // Load projects from localStorage on mount\r\n  useEffect(() => {\r\n    const loadFromStorage = () => {\r\n      try {\r\n        const stored = localStorage.getItem('nocodile_projects');\r\n        if (stored) {\r\n          const parsed = JSON.parse(stored);\r\n          const projectMap = new Map<string, ProjectDetails>();\r\n          \r\n          Object.entries(parsed).forEach(([key, value]) => {\r\n            projectMap.set(key, value as ProjectDetails);\r\n          });\r\n          \r\n          setProjects(projectMap);\r\n          log.info('PROJECT_CONTEXT', 'Loaded projects from localStorage', { \r\n            count: projectMap.size \r\n          });\r\n        }\r\n      } catch (error) {\r\n        log.error('PROJECT_CONTEXT', 'Failed to load projects from localStorage', { \r\n          error: error instanceof Error ? error.message : String(error) \r\n        });\r\n      }\r\n    };\r\n\r\n    loadFromStorage();\r\n  }, []);\r\n\r\n  // Save projects to localStorage whenever projects change\r\n  useEffect(() => {\r\n    try {\r\n      const projectsObj = Object.fromEntries(projects);\r\n      localStorage.setItem('nocodile_projects', JSON.stringify(projectsObj));\r\n      log.debug('PROJECT_CONTEXT', 'Saved projects to localStorage', { \r\n        count: projects.size \r\n      });\r\n    } catch (error) {\r\n      log.error('PROJECT_CONTEXT', 'Failed to save projects to localStorage', { \r\n        error: error instanceof Error ? error.message : String(error) \r\n      });\r\n    }\r\n  }, [projects]);\r\n\r\n  const getProject = (projectId: string): ProjectDetails | null => {\r\n    return projects.get(projectId) || null;\r\n  };\r\n\r\n  const updateProject = (projectId: string, details: Partial<ProjectDetails>) => {\r\n    setProjects(prev => {\r\n      const newMap = new Map(prev);\r\n      const existing = newMap.get(projectId) || {\r\n        id: projectId,\r\n        name: 'Loading...',\r\n        description: 'Loading...',\r\n        videoCount: 0,\r\n        imageCount: 0,\r\n        status: 'Unknown',\r\n        lastUpdated: new Date().toISOString()\r\n      };\r\n      \r\n      const updated = {\r\n        ...existing,\r\n        ...details,\r\n        lastUpdated: new Date().toISOString()\r\n      };\r\n      \r\n      newMap.set(projectId, updated);\r\n      return newMap;\r\n    });\r\n  };\r\n\r\n  const refreshProject = async (projectId: string) => {\r\n    setIsLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      log.info('PROJECT_CONTEXT', 'Refreshing project details', { projectId });\r\n      \r\n      const projectDetails = await ApiService.getProjectDetails(parseInt(projectId));\r\n      \r\n      const updatedDetails: ProjectDetails = {\r\n        id: projectId,\r\n        name: projectDetails[\"project name\"] || \"Unknown Project\",\r\n        description: projectDetails[\"project type\"] || \"No description available\",\r\n        videoCount: projectDetails[\"video count\"] || 0,\r\n        imageCount: 0, // API doesn't provide image count\r\n        status: projectDetails[\"status\"] || \"Active\",\r\n        lastUpdated: new Date().toISOString()\r\n      };\r\n      \r\n      updateProject(projectId, updatedDetails);\r\n      \r\n      log.info('PROJECT_CONTEXT', 'Project details refreshed successfully', { \r\n        projectId, \r\n        name: updatedDetails.name \r\n      });\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : String(error);\r\n      log.error('PROJECT_CONTEXT', 'Failed to refresh project details', { \r\n        projectId, \r\n        error: errorMessage \r\n      });\r\n      setError(errorMessage);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const refreshAllProjects = async () => {\r\n    setIsLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      log.info('PROJECT_CONTEXT', 'Refreshing all projects');\r\n      \r\n      // Get all project IDs from current projects\r\n      const projectIds = Array.from(projects.keys());\r\n      \r\n      if (projectIds.length === 0) {\r\n        log.info('PROJECT_CONTEXT', 'No projects to refresh');\r\n        return;\r\n      }\r\n      \r\n      // Refresh each project\r\n      await Promise.all(projectIds.map(id => refreshProject(id)));\r\n      \r\n      log.info('PROJECT_CONTEXT', 'All projects refreshed successfully');\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : String(error);\r\n      log.error('PROJECT_CONTEXT', 'Failed to refresh all projects', { \r\n        error: errorMessage \r\n      });\r\n      setError(errorMessage);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const value: ProjectContextType = {\r\n    projects,\r\n    getProject,\r\n    updateProject,\r\n    refreshProject,\r\n    refreshAllProjects,\r\n    isLoading,\r\n    error\r\n  };\r\n\r\n  return (\r\n    <ProjectContext.Provider value={value}>\r\n      {children}\r\n    </ProjectContext.Provider>\r\n  );\r\n};\r\n"],"names":[],"mappings":"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","debugId":null}}]
}